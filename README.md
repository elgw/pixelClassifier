# pixel classification

This repo contains code to generate a make a binary classification decision
for pixels in 2D images.  Eventually classifier is exported as C-code and
compiles it into a mex file. The c-based classifier is about 50x faster
(single core) than the one built in to MATLAB.

Here is how it is used:
1. Choose a training image.
2. Create a copy of the training image and annotate it
   in your favorite drawing program. Use red and green to indicate
   background and objects.
3. Extract features from the labeled pixels in the training image
4. Build a random forest to classify the pixels.
5. Export the classifier as C-code.
6. Compile the classifier.
7. Use the classifier.

## Contents

 - [Pixel Features](#features)
 - [Classifier](#classifier)
 - [To Do](#todo)
 - [References](#references)


<a name="features" />

## Pixel Features
Just like Ilastic, features are extracted at multiple scales. The built
in features are:
 - Gaussian (1)
 - Laplacian of Gaussians (1)
 - Gradient magnitude (1)
 - Structure tensor eigenvalues (2)
 - Hessian eigenvalues (2)

<a name="classifier" />

## Classifier

Uses the class `TreeBagger` in MATLAB for classification. There is also `templateTree`/`fitensebmle`, see [this comparison](https://se.mathworks.com/help/stats/ensemble-algorithms.html#bsxabwd).


<a name="todo" />

# TODO
Desirable features:
 - [ ] Parallelized classifier
 - [x] Translate classifier directly to c-code?

## Files:
 - `px_interactive` -- interactively mark two classes in an image and then classify it.
 - `px_gen_classifier` -- generate a classifier from an image and a label image.
 - `px_classify_image` -- classify an image (by name) using a classifier/model generated by `px_gen_classifier`. This function processes the image in tiles (with some overlap) so that it doesn't consume too much memory.
 - `px_classify_region` -- classify a image matrix. Used by px_classify_image.
 - `mode_to_c.m` -- convert a TreeBagger model into a compiled mex function `cMdl`

 - `createComposite` -- merge channels and segmentation result.

<a name="references" />

# References
 -[Ilastic](https://www.ilastik.org/) A very user friendly program for 2D and 3D pixel classification. This is probably what you really want.
